<!doctype html>
<html>
<head>
  <meta charset=utf-8>
  <meta name=viewport content="intial-scale=1">
  <title>audio-feeder demo</title>
<body>
  <h1>audio-feeder demo</h1>
  <p>Plays middle C note for 1 second</p>
  <button id=start disabled>Start audio</button>
  <button id=stop disabled>Stop audio</button>

  <script src="AudioFeeder.js"></script>
  <script>
    (function() {
      var start = document.getElementById('start'),
        stop = document.getElementById('stop'),
        channels = 1,
        samples = 48000,
        feeder = new AudioFeeder();

      function bufferSineWave() {
        var freq = 261, // middle C
          buffer = new Float32Array(samples),
          packet = [buffer];

        for (var i = 0; i < samples; i++) {
          buffer[i] = Math.sin((i / samples) * freq * 2 * Math.PI);
        }

        feeder.bufferData(packet);
      }

      start.addEventListener('click', function() {
        start.disabled = true;
        feeder.init(channels, samples);
        feeder.waitUntilReady(function() {
          stop.disabled = false;

          bufferSineWave();
          feeder.start();
        });
      });

      stop.addEventListener('click', function() {
        stop.disabled = true;
        feeder.close();
        feeder = new AudioFeeder();
        start.disabled = false;
      });

      feeder.onstarved = function() {
        setTimeout(function() {
          stop.disabled = true;
          feeder.close();
          feeder = new AudioFeeder();
          start.disabled = false;
        });
      };

      start.disabled = false;
    })();
  </script>
